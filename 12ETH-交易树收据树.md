# 交易树和收据树
每次发布一个区块，区块中的交易会形成一颗Merkle Tree,即交易树。此外，以太坊还添加了一颗收据树，每个交易执行完之后形成一个收据，记录交易的相关信息.也就是说，交易树和收据树上的节点是一一对应的，目的是能够快速查询交易记录。
# bloom_filter
以太坊中用来快速查找某个元素是否在集合中的数据结构。与哈希表类似，将集合元素取哈希映射到某个地址，该地址只能存储1或者0(PS：如果能够存放计数器，那么就该考虑计数的溢出问题，违背了原本快速查找的初衷。)
[bloom_filter](pic/bloom_filter.png)

## bloom fileter不支持删除
因为哈希碰撞的存在，两个元素的哈希可能映射到同一个地址上，倘若支持删除操作。前一个元素将该地址的值删为0，则造成了后一个元素不存在的假象。因此bloom filter不支持删除操作。

## bloom filter的作用
每次交易完成后会产生一个收据，收据包含一个bloom filter来记录交易类型、地址等信息，在区块block header中也包含一个总的bloom filter，其为该区块中所有交易的bloom filter的一个子集。

如何查询过去十天与这个智能合约相关的交易的信息呢？
先查一下哪个区块的块头有我所需要的bloom filter，如果块头中有的话，再去查这个块中的包含的交易，所对应的收据树的每个收据中的bloom filter，也可能都没有，则发生了误报。如果有的话，则找到相应的交易进行确认。好处是bloom filter这样的结构，能够快速过滤大量无关区块，提高效率。

## eth创建新的账户流程
流程和BTC创建新的账户一样，只要在本地创建一个公私钥对即可,创建后别人就可以发起转账。

## 为什么eth需要有一颗状态树保存所有用户状态，只保存当前区块的交易涉及的用户的状态可以吗？
不可以，当某个账户很久没有完成交易时，突然他想要完成一笔交易，这时候就需要往前寻找很多个区块才能找到之前的状态。
结合上一个问题考虑，如果要转账给某个新建的账户。那么按照只保存当前区块交易涉及用户的方法来，eth需要遍历所有区块最后才能够发现，当前账户是一个新建的账户，显然效率十分低下。