# 数字货币面临的挑战

***双花攻击***，数字货币本身是文件，双花攻击是指通过复制产生多个数字货币。单个货币被用在了多次交易中。
如何防范数字货币？通过可信第三方验证机构维护一张hash table，记录每个货币的主人是谁.

# 去中心化

去中心化即没有可信的第三方参与，节点与节点之间相互平等。
去中心化面临货币发行的问题————发行多少？如何发行？  
————比特币通过贡献算力来获取记账权，获取记账权的同时会获得比特币作为奖励（此时就发行了比特币）.比特币协议规定随着比特币发行数量的增多,每次奖励的比特币数会相应减少一半。

# 区块链交易模型

完成一次交易需要提供付款人的签名、收款人的地址，收款人的地址通常为收款人公钥的哈希值.
在交易中，收款方需要知道付款方的公钥，以便能够验证币的合法性，然而付款方的公钥不能由付款方直接给出，否则付款方能够给出他人的公钥以套用他人的钱包。
[block_chain](pic/block_chain.png)

# 比特币区块

比特币区块由block header和block body组成，其中block header包含：
+ version-版本信息
+ hash of previous block header-前一个块头的哈希值
+ merkle root hash- merkle tree的根节点值
+ target-挖矿中的目标阈值
+ nonce-挖矿中需要不断尝试的随机数

block body包含：
+ transaction list交易记录列表，即merkle tree


# full node 和 light node

比特币的节点分为全节点与轻节点
全节点中存放了block header和block body，是fully validating node，即支持对交易进行验证,全节点的数量较少。
轻节点只block header，提供一些基本的查询服务，不支持交易验证,轻节点的数量较多，每个比特币交易app都是一个轻节点。


# 比特币中的共识协议

## 解决的问题
某些节点是有恶意的，必须屏蔽恶意节点。
## 分布式共识(distributed consensus)
### FLP impossibility result
系统网络传输是异步的，网络时延没有上限，如果有其中一个进程运行失败，那么无法保证所有成员达成共识。
### CAP TheoremC
C:consistency 一致性
A:Availability 可靠性
P:Partition tolerance 容错性
任何一个分布式系统中这三个性质最多只能同时满足其中两个。

# 比特币中的共识协议(Consensus in Bitcoin)

## 直接投票法
由所有节点为某次交易投票，根据票数决定该节点是否被记录到区块链中。  
缺点很明显，容易遭受女巫攻击.  
所谓女巫攻击就是攻击者伪造出多个节点，通过操控这多个节点来使非法交易被记录到区块链中。
## 算力投票
算力投票是比特币使用的共识协议，每个节点尝试找出nonce值，当找到了符合条件的nonce值时该节点获得记账权，并且获得一定数量的比特币奖励。
从而该节点可以将区块发布到区块链中，各个节点收到区块之后验证其合法性，如果大多数节点通过则该区块加入区块链中。